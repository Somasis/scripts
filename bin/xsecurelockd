#!/bin/execlineb

elgetopt l
elgetpositionals
importas -i -u 0 0
importas -D 0 -u ELGETOPT_l ELGETOPT_l

importas -u HOME HOME
importas -D ${HOME}/.config -u XDG_CONFIG_HOME XDG_CONFIG_HOME
importas -u DISPLAY DISPLAY
s6-env -i DISPLAY="${DISPLAY}" XDG_CONFIG_HOME="${XDG_CONFIG_HOME}"

s6-envdir ${XDG_CONFIG_HOME}/xsecurelockd

ifelse { test $ELGETOPT_l -eq 1 } { if { xsecurelock } exit }

importas -D 600 -u TIMEOUT TIMEOUT if { xset s ${TIMEOUT} }
xss-lock -n "/usr/lib/xsecurelock/dimmer" -l -- ${0} -l
