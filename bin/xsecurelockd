#!/bin/execlineb

elgetopt l
elgetpositionals
importas -D 0 -u ELGETOPT_l ELGETOPT_l

importas -u HOME HOME
importas -D ${HOME}/.config -u XDG_CONFIG_HOME XDG_CONFIG_HOME
importas -u DISPLAY DISPLAY
s6-env -i DISPLAY="${DISPLAY}" XDG_CONFIG_HOME="${XDG_CONFIG_HOME}"

ifelse { test -d ${XDG_CONFIG_HOME}/xsecurelockd/config } { exit 1 }
s6-envdir ${XDG_CONFIG_HOME}/xsecurelockd s6-env

ifelse { test $ELGETOPT_l -eq 1 } { if { xsecurelock } exit }

importas -D 600 -u TIMEOUT TIMEOUT
xidle -program "xsecurelockd -l" -timeout ${TIMEOUT}
